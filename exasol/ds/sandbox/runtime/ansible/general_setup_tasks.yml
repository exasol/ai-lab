- name: Update and upgrade apt packages
  apt:
    upgrade: yes
    update_cache: yes
  become: "{{need_sudo}}"
- name: Install rsync
  include_role:
    name: rsync
- name: Install Poetry
  include_role:
    name: poetry
- name: Copy Entry Point Script
  include_role:
    name: entrypoint
- name: Install Jupyter
  include_role:
    name: jupyter
- name: Clear pip cache
  ansible.builtin.file:
    path: /root/.cache/pip
    state: absent
- name: Install Docker
  include_role:
    name: docker
- name: Set facts for entry point
  ansible.builtin.set_fact:
    dss_ansible_facts:
      entrypoint: "{{entrypoint_script}}"
      notebook_folder:
        defaults: "{{notebook_folder}}"
        final: "{{notebook_folder_final}}"
    cacheable: yes
